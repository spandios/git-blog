# 애그리거트 루트

### Aggregate Root란?

애그리거트에 속한 모든 객체가 일관된 상태를 유지하기 위해 전체를 관리하는 주체

![](<../../../.gitbook/assets/스크린샷 2023-02-08 오후 4.50.08.png>)

위의 예시에서의 애그리거트 루트는 Order이다.

이 외에 Value Type인 OrderLine, ShippingInfo, Orderer 등은 루트 역할을 하는 Order Entity에 직접 또는 간접적으로 속하게 되며, 루트 객체에게 관리 받는다.



### 핵심 역할

애그리거트 루트의 핵심 역할은 단순히 엔티티나 밸류 타입의 객체를 모아놓는게 아니다.

도메인의 규칙이나 기능을 애그리거트 루트가 주체적으로 실질적으로 구현하여 제공하는 것이 주어진 핵심 역할이다.&#x20;

핵심 역할을 잘 수행해 애그리거트 루트에 속한 도메인 모델들이 일관성 있게 유지되는 것이 중요하다.&#x20;



### 일관성을 위한 캡슐화&#x20;

외부에서 애그리거트 루트에게 허락 없이 상태를 변경해서는 안 된다. 애그리거트 루트가 통제하지 못 하면 도메인 모델의 일관성은 깨질 것이다.&#x20;

애그리거트 루트에게 각 객체를 주체적으로 관리하는 역할을 잘 수행할 수 있도록 설계하자.

#### 도움이 되는 습관

* 생각 없이 set메서드를 public하게 두지 않는다.&#x20;
* 밸류 객체는 불변으로 해 상태가 함부로 변경 되지 않게 한다.&#x20;



### 트랜잭션과 결합도

한 애그리거트가 다른 애그리거트를 수정하는 작업은, 한 트랜잭션 안에서 두 개 이상의 애거리거트를 수정하면 충돌이 발생할 가능성이 높아지며, 성능에도 좋지 않다.&#x20;

뿐만아니라 다른 애그리거트의 상태를 변경하는 것까지 책임을 맡으면, 둘 간의 결합도가 높아지기 때문에 좋지 않은 설계이다.&#x20;

두 개 이상의 애그리거트를 수정하기 위해서는 응용 계층에서의 서비스가 이 책임을 맡도록 하거나, 도메인 이벤트를 사용하자.&#x20;



