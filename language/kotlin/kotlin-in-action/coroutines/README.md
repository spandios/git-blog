---
description: Kotlin의 Ko가 아니였다~
---

# Coroutines

{% hint style="info" %}
코루틴이란?

코루틴(coroutine)은 [루틴](https://ko.wikipedia.org/wiki/%EB%A3%A8%ED%8B%B4)(함수)의 일종으로서, 비선점형 멀티태스킹을 수행하는 협동 루틴이라 할 수 있다(코루틴의 "Co"는 with 또는 together를 뜻한다). 어떠한 코루틴이 발동될 때마다 해당 코루틴은 이전에 자신의 실행이 마지막으로 중단되었던 지점 다음의 장소에서 실행을 재개한다.

\-위키백과
{% endhint %}

루틴이란 여러 명령어를 모아 이름을 부여해서 반복 호출할 수 있게 정의한 요소로, 쉽게 말해 함수이다.&#x20;

루틴에 진입하는 방법은 해당 함수를 호출해 처음부터 끝까지 실행되는 딱 한가지이다. 그때마다 활성 레코드라는 것이 스택에 할당되어 루틴 내부의 로컬 변수 등이 초기화 된다. 루틴에서 반환되고 나면 활성 레코드 스택이 사라기지 때문에 실행 중이던 모든 상태를 잃어버린다. 그래서 함수를 여러번 반복 실행해도 항상 같은 결과를 얻게 되는 것이다.&#x20;

위의 정의 중 비선점으로 멀티태스킹을 수행한다고 했는데 이는 작업을 수행하는 참여자(루틴)들을 강제로 막고 다른 참여자에게 실행하게 만들지 않는 것이다. 각 참여자들이 서로 자발적으로 협력해 수행한다는 뜻이다.&#x20;

코루틴의 Generator를 예를 들어보자. 어떤 함수 A가 동작하다가 코루틴 B가 실행되면 A가 실행되던 스레드 안에서 코루틴 B가 실행된다. 코루틴 B는 작업을 수행하다가 다시 A에게 작업을 양보한다(yield). 이제 A는 다시 작업을 시작하다가 다시 코루틴 B를 호출한다. 이 때 코루틴 B는 스택이 사라져 상태가 초기화되는 루틴과 달리 yield로 양보했던 그 지점부터 다시 작업을 실행한다.&#x20;



<img src="../../../../.gitbook/assets/file.excalidraw (24).svg" alt="" class="gitbook-drawing">



이렇게 코루틴은 동시에 실행되는 여러 개의 루틴끼리 협력하고, 필요하면 데이터를 교환하면서 작업을 수행하는 루틴을 말한다. 코루틴은 멀티태스킹을 위한 경량 스레드로 생각할 수 있다. 코루틴은 스레드보다 오버헤드가 적고 스케쥴링이 더 유연하여 많은 수의 코루틴을 병렬로 실행하는 것이 더 효율적이다. 코루틴은 병렬성을 지원하면서도 데이터 경쟁을 방지하기 위해 상호 배타적으로 실행된다. 코루틴을 사용하면 복잡한 비동기 작업을 간단하고도 효과적으로 처리할 수 있다.



## 코루틴 vs 멀티 쓰레드

코루틴은 하나의 스레드에서 실행되는 함수이다. 여러 개의 코루틴이 한 함수에서 실행될 수 있다. 각 코루틴은 서로 협력하면서 동작한다. 이를 통해 병렬로 실행되는 것처럼 보인다.&#x20;

반면에, 멀티쓰레드는 여러 개의 스레드가 동시에 실행되는 것을 뜻한다. 각 스레드는 독립적인 실행 흐름을 갖고 있으며, 서로 다른 작업을 수행할 수 있다. 멀티쓰레드는 병렬처리가 가능하므로 빠른 실행 속도를 보장할 수 있지만, 스레드 간의 동기화 문제로 인해 안정성 문제가 발생할 수 있다. 또한, 스레드를 생성하고 전환하는 데 많은 오버헤드가 발생할 수 있다.

따라서, 코루틴은 경량화된 스레드라고 볼 수 있으며, 멀티쓰레드보다 작업량이 적은 프로그램에서는 코루틴이 더 효율적적일것이다. 하지만, CPU 바운드 작업(계산 작업)을 수행하는 경우 멀티쓰레드가 더 적합할 수 있다.

